{
  "timestamp": "2025-10-01T21:41:19.585Z",
  "tests": [
    {
      "name": "1. Basic ALLOW - just resource and action",
      "subOrgId": "9354d83c-2437-45ec-9b9e-becf9549aa52",
      "eoaUserId": "2a1b4db4-f134-4841-af6a-90a773cde3a8",
      "walletAddress": "0xB5102E3BA5ab8aCab5168EAEd96A1d1843fCa6AD",
      "policy": {
        "effect": "EFFECT_ALLOW",
        "condition": "activity.resource == 'PRIVATE_KEY' && activity.action == 'SIGN'",
        "consensus": "approvers.any(user, user.id == '2a1b4db4-f134-4841-af6a-90a773cde3a8')"
      },
      "result": {
        "success": false,
        "reason": "Policy allows DAI when it should only allow USDC",
        "usdcPassed": true,
        "daiPassed": true
      }
    },
    {
      "name": "2. Add primary_type check",
      "subOrgId": "2141731c-220d-4b03-9e61-3bcda53c71e9",
      "eoaUserId": "739d26f6-a1ee-46dd-a4ac-5f20b636f696",
      "walletAddress": "0xB6C707AE33bcaB097ceDcaDEA9b7b8d6F042c130",
      "policy": {
        "effect": "EFFECT_ALLOW",
        "condition": "activity.resource == 'PRIVATE_KEY' && activity.action == 'SIGN' && eth.eip_712.primary_type == 'Execution'",
        "consensus": "approvers.any(user, user.id == '739d26f6-a1ee-46dd-a4ac-5f20b636f696')"
      },
      "result": {
        "success": false,
        "reason": "Policy allows DAI when it should only allow USDC",
        "usdcPassed": true,
        "daiPassed": true
      }
    },
    {
      "name": "3. Add outputContract check (USDC)",
      "subOrgId": "d4485c98-41df-4c18-a41f-9f0d5f1ab956",
      "eoaUserId": "1310adbd-9ced-4f2a-ad81-7557d3b661b7",
      "walletAddress": "0x199E5C984dA36869739B2816fecb227027D5409B",
      "policy": {
        "effect": "EFFECT_ALLOW",
        "condition": "activity.resource == 'PRIVATE_KEY' && activity.action == 'SIGN' && eth.eip_712.primary_type == 'Execution' && eth.eip_712.message['outputContract'] == '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913'",
        "consensus": "approvers.any(user, user.id == '1310adbd-9ced-4f2a-ad81-7557d3b661b7')"
      },
      "result": {
        "success": false,
        "reason": "Policy allows DAI when it should only allow USDC",
        "usdcPassed": true,
        "daiPassed": true
      }
    },
    {
      "name": "4. Try approvers.any with true",
      "subOrgId": "181cd13b-83e1-46b3-9705-c1527927ec9a",
      "eoaUserId": "4d7fe133-44be-431e-b3dc-547285344a4d",
      "walletAddress": "0xA0911FF49D5650bf7F83995e5780E9e5F9b27329",
      "policy": {
        "effect": "EFFECT_ALLOW",
        "condition": "activity.resource == 'PRIVATE_KEY' && activity.action == 'SIGN' && eth.eip_712.primary_type == 'Execution' && eth.eip_712.message['outputContract'] == '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913'",
        "consensus": "approvers.any(user, true)"
      },
      "result": {
        "success": false,
        "reason": "Policy allows DAI when it should only allow USDC",
        "usdcPassed": true,
        "daiPassed": true
      }
    },
    {
      "name": "5. Try DENY policy for non-USDC",
      "subOrgId": "8afa68ca-77b7-4331-8a4e-4afc11b52944",
      "eoaUserId": "c93fe690-4f64-4048-8006-d3e921f63a7e",
      "walletAddress": "0x03d4EBe6d979aB1b1559F129f3da8Ba6277d0A52",
      "policy": {
        "effect": "EFFECT_DENY",
        "condition": "activity.resource == 'PRIVATE_KEY' && activity.action == 'SIGN' && eth.eip_712.primary_type == 'Execution' && eth.eip_712.message['outputContract'] != '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913'",
        "consensus": "approvers.any(user, true)"
      },
      "result": {
        "success": false,
        "reason": "Policy allows DAI when it should only allow USDC",
        "usdcPassed": true,
        "daiPassed": true
      }
    },
    {
      "name": "6. Try consensus with user.tags",
      "subOrgId": "75c34255-c7fa-4736-aa91-734927149a3f",
      "eoaUserId": "e305a04e-8c9c-42bc-a70c-01df3b344d14",
      "walletAddress": "0xf7eED72b7E03109360CE6F2A819C59F8411fEe86",
      "policy": {
        "effect": "EFFECT_ALLOW",
        "condition": "activity.resource == 'PRIVATE_KEY' && activity.action == 'SIGN' && eth.eip_712.primary_type == 'Execution' && eth.eip_712.message['outputContract'] == '0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913'",
        "consensus": "approvers.any(user, user.id == 'e305a04e-8c9c-42bc-a70c-01df3b344d14' || true)"
      },
      "result": {
        "success": false,
        "reason": "Policy allows DAI when it should only allow USDC",
        "usdcPassed": true,
        "daiPassed": true
      }
    }
  ]
}