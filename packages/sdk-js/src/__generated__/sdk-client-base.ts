/* @generated by codegen. DO NOT EDIT BY HAND */

import {
  TERMINAL_ACTIVITY_STATUSES,
  TActivityResponse,
  TActivityStatus,
  TSignedRequest,
} from "@turnkey/http";

import type { definitions } from "../__inputs__/public_api.types";

import {
  GrpcStatus,
  TStamper,
  TurnkeyRequestError,
  TurnkeyHttpClientConfig,
} from "../__types__/base";

import { VERSION } from "../__generated__/version";

import type * as SdkApiTypes from "./sdk_api_types";

import type * as SdkTypes from "@turnkey/sdk-types";

import { StorageBase } from "../__storage__/base";

import { parseSession } from "../utils";

import { StamperType } from "../__types__/base";

export class TurnkeySDKClientBase {
  config: TurnkeyHttpClientConfig;

  // Store stampers
  private apiKeyStamper?: TStamper | undefined;
  private passkeyStamper?: TStamper | undefined;

  // Storage manager
  private storageManager?: StorageBase | undefined;

  constructor(config: TurnkeyHttpClientConfig) {
    this.config = config;

    if (config.apiKeyStamper) {
      this.apiKeyStamper = config.apiKeyStamper;
    }
    if (config.passkeyStamper) {
      this.passkeyStamper = config.passkeyStamper;
    }
    if (config.storageManager) {
      this.storageManager = config.storageManager;
    }
  }

  private getStamper(stampWith?: StamperType): TStamper | undefined {
    if (!stampWith) return this.apiKeyStamper || this.passkeyStamper;

    switch (stampWith) {
      case StamperType.ApiKey:
        return this.apiKeyStamper;
      case StamperType.Passkey:
        return this.passkeyStamper;
      default:
        return this.apiKeyStamper;
    }
  }

  async request<TBodyType, TResponseType>(
    url: string,
    body: TBodyType,
    stampWith?: StamperType,
  ): Promise<TResponseType> {
    const fullUrl = this.config.apiBaseUrl + url;
    const stringifiedBody = JSON.stringify(body);
    var headers: Record<string, string> = {
      "X-Client-Version": VERSION,
    };

    // Use the specified stamper for this request
    const activeStamper = this.getStamper(stampWith);

    if (activeStamper) {
      const stamp = await activeStamper.stamp(stringifiedBody);
      headers[stamp.stampHeaderName] = stamp.stampHeaderValue;
    }

    if (this.config.readOnlySession) {
      headers["X-Session"] = this.config.readOnlySession;
    }

    const response = await fetch(fullUrl, {
      method: "POST",
      headers: headers,
      body: stringifiedBody,
      redirect: "follow",
    });

    if (!response.ok) {
      let res: GrpcStatus;
      try {
        res = await response.json();
      } catch (_) {
        throw new Error(`${response.status} ${response.statusText}`);
      }

      throw new TurnkeyRequestError(res);
    }

    const data = await response.json();
    return data as TResponseType;
  }

  async command<TBodyType, TResponseType>(
    url: string,
    body: TBodyType,
    resultKey: string,
    stampWith?: StamperType,
  ): Promise<TResponseType> {
    const pollingDuration = this.config.activityPoller?.intervalMs ?? 1000;
    const maxRetries = this.config.activityPoller?.numRetries ?? 3;

    const sleep = (ms: number) =>
      new Promise((resolve) => setTimeout(resolve, ms));

    const handleResponse = (activityData: TActivityResponse): TResponseType => {
      const { result, status } = activityData.activity;

      if (status === "ACTIVITY_STATUS_COMPLETED") {
        return {
          ...result[`${resultKey}` as keyof definitions["v1Result"]],
          ...activityData,
        } as TResponseType;
      }

      return activityData as TResponseType;
    };

    let attempts = 0;

    const pollStatus = async (activityId: string): Promise<TResponseType> => {
      const pollBody = { activityId };
      // Pass the stampWith parameter to getActivity
      const pollData = (await this.getActivity(
        pollBody,
        stampWith,
      )) as TActivityResponse;

      if (attempts > maxRetries) {
        return handleResponse(pollData);
      }

      attempts += 1;

      if (
        !TERMINAL_ACTIVITY_STATUSES.includes(
          pollData.activity.status as TActivityStatus,
        )
      ) {
        await sleep(pollingDuration);
        return pollStatus(activityId);
      }

      return handleResponse(pollData);
    };

    // Use the specified stamper for the initial request
    const responseData = (await this.request<TBodyType, TResponseType>(
      url,
      body,
      stampWith,
    )) as TActivityResponse;

    if (
      !TERMINAL_ACTIVITY_STATUSES.includes(
        responseData.activity.status as TActivityStatus,
      )
    ) {
      return pollStatus(responseData.activity.id);
    }

    return handleResponse(responseData);
  }

  async activityDecision<TBodyType, TResponseType>(
    url: string,
    body: TBodyType,
    stampWith?: StamperType,
  ): Promise<TResponseType> {
    // Use the specified stamper for this request
    const activityData = (await this.request(
      url,
      body,
      stampWith,
    )) as TActivityResponse;

    return {
      ...activityData["activity"]["result"],
      ...activityData,
    } as TResponseType;
  }

  getActivity = async (
    input: SdkTypes.GetActivityRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetActivityResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_activity",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetActivity = async (
    input: SdkTypes.GetActivityRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/get_activity";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getApiKey = async (
    input: SdkTypes.GetApiKeyRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetApiKeyResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_api_key",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetApiKey = async (
    input: SdkTypes.GetApiKeyRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/get_api_key";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getApiKeys = async (
    input: SdkTypes.GetApiKeysRequest = {},
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetApiKeysResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_api_keys",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetApiKeys = async (
    input: SdkTypes.GetApiKeysRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/get_api_keys";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getAttestationDocument = async (
    input: SdkTypes.GetAttestationDocumentRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetAttestationDocumentResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_attestation",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetAttestationDocument = async (
    input: SdkTypes.GetAttestationDocumentRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/get_attestation";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getAuthenticator = async (
    input: SdkTypes.GetAuthenticatorRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetAuthenticatorResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_authenticator",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetAuthenticator = async (
    input: SdkTypes.GetAuthenticatorRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/query/get_authenticator";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getAuthenticators = async (
    input: SdkTypes.GetAuthenticatorsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetAuthenticatorsResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_authenticators",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetAuthenticators = async (
    input: SdkTypes.GetAuthenticatorsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/query/get_authenticators";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getOauthProviders = async (
    input: SdkTypes.GetOauthProvidersRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetOauthProvidersResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_oauth_providers",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetOauthProviders = async (
    input: SdkTypes.GetOauthProvidersRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/query/get_oauth_providers";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getOrganization = async (
    input: SdkTypes.GetOrganizationRequest = {},
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetOrganizationResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_organization",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetOrganization = async (
    input: SdkTypes.GetOrganizationRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/query/get_organization";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getOrganizationConfigs = async (
    input: SdkTypes.GetOrganizationConfigsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetOrganizationConfigsResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_organization_configs",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetOrganizationConfigs = async (
    input: SdkTypes.GetOrganizationConfigsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/query/get_organization_configs";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getPolicy = async (
    input: SdkTypes.GetPolicyRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetPolicyResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_policy",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetPolicy = async (
    input: SdkTypes.GetPolicyRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/get_policy";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getPrivateKey = async (
    input: SdkTypes.GetPrivateKeyRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetPrivateKeyResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_private_key",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetPrivateKey = async (
    input: SdkTypes.GetPrivateKeyRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/get_private_key";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getUser = async (
    input: SdkTypes.GetUserRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetUserResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_user",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetUser = async (
    input: SdkTypes.GetUserRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/get_user";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getWallet = async (
    input: SdkTypes.GetWalletRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetWalletResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_wallet",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetWallet = async (
    input: SdkTypes.GetWalletRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/get_wallet";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getWalletAccount = async (
    input: SdkTypes.GetWalletAccountRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetWalletAccountResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/get_wallet_account",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetWalletAccount = async (
    input: SdkTypes.GetWalletAccountRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/query/get_wallet_account";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getActivities = async (
    input: SdkTypes.GetActivitiesRequest = {},
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetActivitiesResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/list_activities",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetActivities = async (
    input: SdkTypes.GetActivitiesRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/list_activities";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getPolicies = async (
    input: SdkTypes.GetPoliciesRequest = {},
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetPoliciesResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/list_policies",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetPolicies = async (
    input: SdkTypes.GetPoliciesRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/list_policies";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  listPrivateKeyTags = async (
    input: SdkTypes.ListPrivateKeyTagsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.ListPrivateKeyTagsResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/list_private_key_tags",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampListPrivateKeyTags = async (
    input: SdkTypes.ListPrivateKeyTagsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/query/list_private_key_tags";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getPrivateKeys = async (
    input: SdkTypes.GetPrivateKeysRequest = {},
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetPrivateKeysResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/list_private_keys",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetPrivateKeys = async (
    input: SdkTypes.GetPrivateKeysRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/query/list_private_keys";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getSubOrgIds = async (
    input: SdkTypes.GetSubOrgIdsRequest = {},
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetSubOrgIdsResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/list_suborgs",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetSubOrgIds = async (
    input: SdkTypes.GetSubOrgIdsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/list_suborgs";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  listUserTags = async (
    input: SdkTypes.ListUserTagsRequest = {},
    stampWith?: StamperType,
  ): Promise<SdkTypes.ListUserTagsResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/list_user_tags",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampListUserTags = async (
    input: SdkTypes.ListUserTagsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/list_user_tags";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getUsers = async (
    input: SdkTypes.GetUsersRequest = {},
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetUsersResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/list_users",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetUsers = async (
    input: SdkTypes.GetUsersRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/list_users";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getVerifiedSubOrgIds = async (
    input: SdkTypes.GetVerifiedSubOrgIdsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetVerifiedSubOrgIdsResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/list_verified_suborgs",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetVerifiedSubOrgIds = async (
    input: SdkTypes.GetVerifiedSubOrgIdsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/query/list_verified_suborgs";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getWalletAccounts = async (
    input: SdkTypes.GetWalletAccountsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetWalletAccountsResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/list_wallet_accounts",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetWalletAccounts = async (
    input: SdkTypes.GetWalletAccountsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/query/list_wallet_accounts";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getWallets = async (
    input: SdkTypes.GetWalletsRequest = {},
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetWalletsResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/list_wallets",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetWallets = async (
    input: SdkTypes.GetWalletsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/list_wallets";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  getWhoami = async (
    input: SdkTypes.GetWhoamiRequest = {},
    stampWith?: StamperType,
  ): Promise<SdkTypes.GetWhoamiResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/public/v1/query/whoami",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampGetWhoami = async (
    input: SdkTypes.GetWhoamiRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/query/whoami";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  approveActivity = async (
    input: SdkTypes.ApproveActivityRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.ApproveActivityResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.activityDecision(
      "/public/v1/submit/approve_activity",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_APPROVE_ACTIVITY",
      },
      stampWith,
    );
  };

  stampApproveActivity = async (
    input: SdkTypes.ApproveActivityRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/approve_activity";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createApiKeys = async (
    input: SdkTypes.CreateApiKeysRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateApiKeysResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_api_keys",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_API_KEYS_V2",
      },
      "createApiKeysResult",
      stampWith,
    );
  };

  stampCreateApiKeys = async (
    input: SdkTypes.CreateApiKeysRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_api_keys";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createApiOnlyUsers = async (
    input: SdkTypes.CreateApiOnlyUsersRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateApiOnlyUsersResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_api_only_users",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_API_ONLY_USERS",
      },
      "createApiOnlyUsersResult",
      stampWith,
    );
  };

  stampCreateApiOnlyUsers = async (
    input: SdkTypes.CreateApiOnlyUsersRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_api_only_users";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createAuthenticators = async (
    input: SdkTypes.CreateAuthenticatorsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateAuthenticatorsResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_authenticators",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_AUTHENTICATORS_V2",
      },
      "createAuthenticatorsResult",
      stampWith,
    );
  };

  stampCreateAuthenticators = async (
    input: SdkTypes.CreateAuthenticatorsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_authenticators";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createInvitations = async (
    input: SdkTypes.CreateInvitationsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateInvitationsResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_invitations",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_INVITATIONS",
      },
      "createInvitationsResult",
      stampWith,
    );
  };

  stampCreateInvitations = async (
    input: SdkTypes.CreateInvitationsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_invitations";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createOauthProviders = async (
    input: SdkTypes.CreateOauthProvidersRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateOauthProvidersResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_oauth_providers",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_OAUTH_PROVIDERS",
      },
      "createOauthProvidersResult",
      stampWith,
    );
  };

  stampCreateOauthProviders = async (
    input: SdkTypes.CreateOauthProvidersRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_oauth_providers";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createPolicies = async (
    input: SdkTypes.CreatePoliciesRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreatePoliciesResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_policies",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_POLICIES",
      },
      "createPoliciesResult",
      stampWith,
    );
  };

  stampCreatePolicies = async (
    input: SdkTypes.CreatePoliciesRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_policies";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createPolicy = async (
    input: SdkTypes.CreatePolicyRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreatePolicyResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_policy",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_POLICY_V3",
      },
      "createPolicyResult",
      stampWith,
    );
  };

  stampCreatePolicy = async (
    input: SdkTypes.CreatePolicyRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/create_policy";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createPrivateKeyTag = async (
    input: SdkTypes.CreatePrivateKeyTagRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreatePrivateKeyTagResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_private_key_tag",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_PRIVATE_KEY_TAG",
      },
      "createPrivateKeyTagResult",
      stampWith,
    );
  };

  stampCreatePrivateKeyTag = async (
    input: SdkTypes.CreatePrivateKeyTagRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_private_key_tag";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createPrivateKeys = async (
    input: SdkTypes.CreatePrivateKeysRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreatePrivateKeysResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_private_keys",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_PRIVATE_KEYS_V2",
      },
      "createPrivateKeysResultV2",
      stampWith,
    );
  };

  stampCreatePrivateKeys = async (
    input: SdkTypes.CreatePrivateKeysRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_private_keys";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createReadOnlySession = async (
    input: SdkTypes.CreateReadOnlySessionRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateReadOnlySessionResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_read_only_session",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_READ_ONLY_SESSION",
      },
      "createReadOnlySessionResult",
      stampWith,
    );
  };

  stampCreateReadOnlySession = async (
    input: SdkTypes.CreateReadOnlySessionRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_read_only_session";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createReadWriteSession = async (
    input: SdkTypes.CreateReadWriteSessionRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateReadWriteSessionResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_read_write_session",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_READ_WRITE_SESSION_V2",
      },
      "createReadWriteSessionResultV2",
      stampWith,
    );
  };

  stampCreateReadWriteSession = async (
    input: SdkTypes.CreateReadWriteSessionRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_read_write_session";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createSubOrganization = async (
    input: SdkTypes.CreateSubOrganizationRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateSubOrganizationResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_sub_organization",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_SUB_ORGANIZATION_V7",
      },
      "createSubOrganizationResultV7",
      stampWith,
    );
  };

  stampCreateSubOrganization = async (
    input: SdkTypes.CreateSubOrganizationRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_sub_organization";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createUserTag = async (
    input: SdkTypes.CreateUserTagRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateUserTagResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_user_tag",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_USER_TAG",
      },
      "createUserTagResult",
      stampWith,
    );
  };

  stampCreateUserTag = async (
    input: SdkTypes.CreateUserTagRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_user_tag";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createUsers = async (
    input: SdkTypes.CreateUsersRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateUsersResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_users",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_USERS_V3",
      },
      "createUsersResult",
      stampWith,
    );
  };

  stampCreateUsers = async (
    input: SdkTypes.CreateUsersRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/create_users";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createWallet = async (
    input: SdkTypes.CreateWalletRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateWalletResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_wallet",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_WALLET",
      },
      "createWalletResult",
      stampWith,
    );
  };

  stampCreateWallet = async (
    input: SdkTypes.CreateWalletRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/create_wallet";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  createWalletAccounts = async (
    input: SdkTypes.CreateWalletAccountsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.CreateWalletAccountsResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/create_wallet_accounts",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_CREATE_WALLET_ACCOUNTS",
      },
      "createWalletAccountsResult",
      stampWith,
    );
  };

  stampCreateWalletAccounts = async (
    input: SdkTypes.CreateWalletAccountsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/create_wallet_accounts";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deleteApiKeys = async (
    input: SdkTypes.DeleteApiKeysRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeleteApiKeysResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_api_keys",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_API_KEYS",
      },
      "deleteApiKeysResult",
      stampWith,
    );
  };

  stampDeleteApiKeys = async (
    input: SdkTypes.DeleteApiKeysRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/delete_api_keys";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deleteAuthenticators = async (
    input: SdkTypes.DeleteAuthenticatorsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeleteAuthenticatorsResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_authenticators",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_AUTHENTICATORS",
      },
      "deleteAuthenticatorsResult",
      stampWith,
    );
  };

  stampDeleteAuthenticators = async (
    input: SdkTypes.DeleteAuthenticatorsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/delete_authenticators";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deleteInvitation = async (
    input: SdkTypes.DeleteInvitationRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeleteInvitationResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_invitation",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_INVITATION",
      },
      "deleteInvitationResult",
      stampWith,
    );
  };

  stampDeleteInvitation = async (
    input: SdkTypes.DeleteInvitationRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/delete_invitation";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deleteOauthProviders = async (
    input: SdkTypes.DeleteOauthProvidersRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeleteOauthProvidersResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_oauth_providers",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_OAUTH_PROVIDERS",
      },
      "deleteOauthProvidersResult",
      stampWith,
    );
  };

  stampDeleteOauthProviders = async (
    input: SdkTypes.DeleteOauthProvidersRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/delete_oauth_providers";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deletePolicy = async (
    input: SdkTypes.DeletePolicyRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeletePolicyResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_policy",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_POLICY",
      },
      "deletePolicyResult",
      stampWith,
    );
  };

  stampDeletePolicy = async (
    input: SdkTypes.DeletePolicyRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/delete_policy";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deletePrivateKeyTags = async (
    input: SdkTypes.DeletePrivateKeyTagsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeletePrivateKeyTagsResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_private_key_tags",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_PRIVATE_KEY_TAGS",
      },
      "deletePrivateKeyTagsResult",
      stampWith,
    );
  };

  stampDeletePrivateKeyTags = async (
    input: SdkTypes.DeletePrivateKeyTagsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/delete_private_key_tags";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deletePrivateKeys = async (
    input: SdkTypes.DeletePrivateKeysRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeletePrivateKeysResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_private_keys",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_PRIVATE_KEYS",
      },
      "deletePrivateKeysResult",
      stampWith,
    );
  };

  stampDeletePrivateKeys = async (
    input: SdkTypes.DeletePrivateKeysRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/delete_private_keys";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deleteSubOrganization = async (
    input: SdkTypes.DeleteSubOrganizationRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeleteSubOrganizationResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_sub_organization",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_SUB_ORGANIZATION",
      },
      "deleteSubOrganizationResult",
      stampWith,
    );
  };

  stampDeleteSubOrganization = async (
    input: SdkTypes.DeleteSubOrganizationRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/delete_sub_organization";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deleteUserTags = async (
    input: SdkTypes.DeleteUserTagsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeleteUserTagsResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_user_tags",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_USER_TAGS",
      },
      "deleteUserTagsResult",
      stampWith,
    );
  };

  stampDeleteUserTags = async (
    input: SdkTypes.DeleteUserTagsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/delete_user_tags";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deleteUsers = async (
    input: SdkTypes.DeleteUsersRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeleteUsersResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_users",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_USERS",
      },
      "deleteUsersResult",
      stampWith,
    );
  };

  stampDeleteUsers = async (
    input: SdkTypes.DeleteUsersRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/delete_users";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  deleteWallets = async (
    input: SdkTypes.DeleteWalletsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.DeleteWalletsResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/delete_wallets",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_DELETE_WALLETS",
      },
      "deleteWalletsResult",
      stampWith,
    );
  };

  stampDeleteWallets = async (
    input: SdkTypes.DeleteWalletsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/delete_wallets";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  emailAuth = async (
    input: SdkTypes.EmailAuthRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.EmailAuthResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/email_auth",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_EMAIL_AUTH_V2",
      },
      "emailAuthResult",
      stampWith,
    );
  };

  stampEmailAuth = async (
    input: SdkTypes.EmailAuthRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/email_auth";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  exportPrivateKey = async (
    input: SdkTypes.ExportPrivateKeyRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.ExportPrivateKeyResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/export_private_key",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_EXPORT_PRIVATE_KEY",
      },
      "exportPrivateKeyResult",
      stampWith,
    );
  };

  stampExportPrivateKey = async (
    input: SdkTypes.ExportPrivateKeyRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/export_private_key";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  exportWallet = async (
    input: SdkTypes.ExportWalletRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.ExportWalletResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/export_wallet",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_EXPORT_WALLET",
      },
      "exportWalletResult",
      stampWith,
    );
  };

  stampExportWallet = async (
    input: SdkTypes.ExportWalletRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/export_wallet";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  exportWalletAccount = async (
    input: SdkTypes.ExportWalletAccountRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.ExportWalletAccountResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/export_wallet_account",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_EXPORT_WALLET_ACCOUNT",
      },
      "exportWalletAccountResult",
      stampWith,
    );
  };

  stampExportWalletAccount = async (
    input: SdkTypes.ExportWalletAccountRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/export_wallet_account";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  importPrivateKey = async (
    input: SdkTypes.ImportPrivateKeyRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.ImportPrivateKeyResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/import_private_key",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_IMPORT_PRIVATE_KEY",
      },
      "importPrivateKeyResult",
      stampWith,
    );
  };

  stampImportPrivateKey = async (
    input: SdkTypes.ImportPrivateKeyRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/import_private_key";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  importWallet = async (
    input: SdkTypes.ImportWalletRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.ImportWalletResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/import_wallet",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_IMPORT_WALLET",
      },
      "importWalletResult",
      stampWith,
    );
  };

  stampImportWallet = async (
    input: SdkTypes.ImportWalletRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/import_wallet";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  initImportPrivateKey = async (
    input: SdkTypes.InitImportPrivateKeyRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.InitImportPrivateKeyResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/init_import_private_key",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_INIT_IMPORT_PRIVATE_KEY",
      },
      "initImportPrivateKeyResult",
      stampWith,
    );
  };

  stampInitImportPrivateKey = async (
    input: SdkTypes.InitImportPrivateKeyRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/init_import_private_key";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  initImportWallet = async (
    input: SdkTypes.InitImportWalletRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.InitImportWalletResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/init_import_wallet",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_INIT_IMPORT_WALLET",
      },
      "initImportWalletResult",
      stampWith,
    );
  };

  stampInitImportWallet = async (
    input: SdkTypes.InitImportWalletRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/init_import_wallet";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  initOtp = async (
    input: SdkTypes.InitOtpRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.InitOtpResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/init_otp",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_INIT_OTP",
      },
      "initOtpResult",
      stampWith,
    );
  };

  stampInitOtp = async (
    input: SdkTypes.InitOtpRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/init_otp";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  initOtpAuth = async (
    input: SdkTypes.InitOtpAuthRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.InitOtpAuthResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/init_otp_auth",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_INIT_OTP_AUTH_V2",
      },
      "initOtpAuthResultV2",
      stampWith,
    );
  };

  stampInitOtpAuth = async (
    input: SdkTypes.InitOtpAuthRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/init_otp_auth";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  initUserEmailRecovery = async (
    input: SdkTypes.InitUserEmailRecoveryRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.InitUserEmailRecoveryResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/init_user_email_recovery",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_INIT_USER_EMAIL_RECOVERY",
      },
      "initUserEmailRecoveryResult",
      stampWith,
    );
  };

  stampInitUserEmailRecovery = async (
    input: SdkTypes.InitUserEmailRecoveryRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/init_user_email_recovery";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  oauth = async (
    input: SdkTypes.OauthRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.OauthResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/oauth",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_OAUTH",
      },
      "oauthResult",
      stampWith,
    );
  };

  stampOauth = async (
    input: SdkTypes.OauthRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/oauth";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  oauthLogin = async (
    input: SdkTypes.OauthLoginRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.OauthLoginResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/oauth_login",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_OAUTH_LOGIN",
      },
      "oauthLoginResult",
      stampWith,
    );
  };

  stampOauthLogin = async (
    input: SdkTypes.OauthLoginRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/oauth_login";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  otpAuth = async (
    input: SdkTypes.OtpAuthRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.OtpAuthResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/otp_auth",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_OTP_AUTH",
      },
      "otpAuthResult",
      stampWith,
    );
  };

  stampOtpAuth = async (
    input: SdkTypes.OtpAuthRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/otp_auth";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  otpLogin = async (
    input: SdkTypes.OtpLoginRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.OtpLoginResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/otp_login",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_OTP_LOGIN",
      },
      "otpLoginResult",
      stampWith,
    );
  };

  stampOtpLogin = async (
    input: SdkTypes.OtpLoginRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/otp_login";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  recoverUser = async (
    input: SdkTypes.RecoverUserRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.RecoverUserResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/recover_user",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_RECOVER_USER",
      },
      "recoverUserResult",
      stampWith,
    );
  };

  stampRecoverUser = async (
    input: SdkTypes.RecoverUserRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/recover_user";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  rejectActivity = async (
    input: SdkTypes.RejectActivityRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.RejectActivityResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.activityDecision(
      "/public/v1/submit/reject_activity",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_REJECT_ACTIVITY",
      },
      stampWith,
    );
  };

  stampRejectActivity = async (
    input: SdkTypes.RejectActivityRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/reject_activity";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  removeOrganizationFeature = async (
    input: SdkTypes.RemoveOrganizationFeatureRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.RemoveOrganizationFeatureResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/remove_organization_feature",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_REMOVE_ORGANIZATION_FEATURE",
      },
      "removeOrganizationFeatureResult",
      stampWith,
    );
  };

  stampRemoveOrganizationFeature = async (
    input: SdkTypes.RemoveOrganizationFeatureRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/remove_organization_feature";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  setOrganizationFeature = async (
    input: SdkTypes.SetOrganizationFeatureRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.SetOrganizationFeatureResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/set_organization_feature",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_SET_ORGANIZATION_FEATURE",
      },
      "setOrganizationFeatureResult",
      stampWith,
    );
  };

  stampSetOrganizationFeature = async (
    input: SdkTypes.SetOrganizationFeatureRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/set_organization_feature";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  signRawPayload = async (
    input: SdkTypes.SignRawPayloadRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.SignRawPayloadResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/sign_raw_payload",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_SIGN_RAW_PAYLOAD_V2",
      },
      "signRawPayloadResult",
      stampWith,
    );
  };

  stampSignRawPayload = async (
    input: SdkTypes.SignRawPayloadRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/sign_raw_payload";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  signRawPayloads = async (
    input: SdkTypes.SignRawPayloadsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.SignRawPayloadsResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/sign_raw_payloads",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_SIGN_RAW_PAYLOADS",
      },
      "signRawPayloadsResult",
      stampWith,
    );
  };

  stampSignRawPayloads = async (
    input: SdkTypes.SignRawPayloadsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/sign_raw_payloads";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  signTransaction = async (
    input: SdkTypes.SignTransactionRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.SignTransactionResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/sign_transaction",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_SIGN_TRANSACTION_V2",
      },
      "signTransactionResult",
      stampWith,
    );
  };

  stampSignTransaction = async (
    input: SdkTypes.SignTransactionRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/sign_transaction";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  stampLogin = async (
    input: SdkTypes.StampLoginRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.StampLoginResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/stamp_login",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_STAMP_LOGIN",
      },
      "stampLoginResult",
      stampWith,
    );
  };

  stampStampLogin = async (
    input: SdkTypes.StampLoginRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/stamp_login";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  updatePolicy = async (
    input: SdkTypes.UpdatePolicyRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.UpdatePolicyResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/update_policy",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_UPDATE_POLICY_V2",
      },
      "updatePolicyResultV2",
      stampWith,
    );
  };

  stampUpdatePolicy = async (
    input: SdkTypes.UpdatePolicyRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/update_policy";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  updatePrivateKeyTag = async (
    input: SdkTypes.UpdatePrivateKeyTagRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.UpdatePrivateKeyTagResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/update_private_key_tag",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_UPDATE_PRIVATE_KEY_TAG",
      },
      "updatePrivateKeyTagResult",
      stampWith,
    );
  };

  stampUpdatePrivateKeyTag = async (
    input: SdkTypes.UpdatePrivateKeyTagRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/update_private_key_tag";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  updateRootQuorum = async (
    input: SdkTypes.UpdateRootQuorumRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.UpdateRootQuorumResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/update_root_quorum",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_UPDATE_ROOT_QUORUM",
      },
      "updateRootQuorumResult",
      stampWith,
    );
  };

  stampUpdateRootQuorum = async (
    input: SdkTypes.UpdateRootQuorumRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/update_root_quorum";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  updateUser = async (
    input: SdkTypes.UpdateUserRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.UpdateUserResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/update_user",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_UPDATE_USER",
      },
      "updateUserResult",
      stampWith,
    );
  };

  stampUpdateUser = async (
    input: SdkTypes.UpdateUserRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/update_user";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  updateUserTag = async (
    input: SdkTypes.UpdateUserTagRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.UpdateUserTagResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/update_user_tag",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_UPDATE_USER_TAG",
      },
      "updateUserTagResult",
      stampWith,
    );
  };

  stampUpdateUserTag = async (
    input: SdkTypes.UpdateUserTagRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl =
      this.config.apiBaseUrl + "/public/v1/submit/update_user_tag";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  updateWallet = async (
    input: SdkTypes.UpdateWalletRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.UpdateWalletResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/update_wallet",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_UPDATE_WALLET",
      },
      "updateWalletResult",
      stampWith,
    );
  };

  stampUpdateWallet = async (
    input: SdkTypes.UpdateWalletRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/update_wallet";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  verifyOtp = async (
    input: SdkTypes.VerifyOtpRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.VerifyOtpResponse> => {
    const { organizationId, timestampMs, ...rest } = input;
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage

    return this.command(
      "/public/v1/submit/verify_otp",
      {
        parameters: rest,
        organizationId:
          organizationId ??
          session?.organizationId ??
          this.config.organizationId,
        timestampMs: timestampMs ?? String(Date.now()),
        type: "ACTIVITY_TYPE_VERIFY_OTP",
      },
      "verifyOtpResult",
      stampWith,
    );
  };

  stampVerifyOtp = async (
    input: SdkTypes.VerifyOtpRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/public/v1/submit/verify_otp";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };

  testRateLimits = async (
    input: SdkTypes.TestRateLimitsRequest,
    stampWith?: StamperType,
  ): Promise<SdkTypes.TestRateLimitsResponse> => {
    let session = await this.storageManager?.getActiveSession();
    session = parseSession(session!); // TODO (Amir): We may not need this anymore since we want to store the full session object in storage
    return this.request(
      "/tkhq/api/v1/test_rate_limits",
      {
        ...input,
        organizationId:
          input.organizationId ??
          session?.organizationId ??
          this.config.organizationId,
      },
      stampWith,
    );
  };

  stampTestRateLimits = async (
    input: SdkTypes.TestRateLimitsRequest,
    stampWith?: StamperType,
  ): Promise<TSignedRequest | undefined> => {
    const activeStamper = this.getStamper(stampWith);
    if (!activeStamper) {
      return undefined;
    }

    const fullUrl = this.config.apiBaseUrl + "/tkhq/api/v1/test_rate_limits";
    const body = JSON.stringify(input);
    const stamp = await activeStamper.stamp(body);
    return {
      body: body,
      stamp: stamp,
      url: fullUrl,
    };
  };
}
